{% extends 'base.html' %}
{% load static  %}

{% block title %}
Candidates List
{% endblock %}

{% block styles %}
<style>
    .hidden {
        display: none;
    }
</style>
{% endblock %}

{% block scripts %}
<script src="{% static 'themes/metronic/theme/default/demo1/dist/assets/plugins/global/plugins.bundle.js' %}"
    type="text/javascript"></script>
<script src="{% static 'themes/metronic/theme/default/demo1/dist/assets/js/scripts.bundle.js' %}"
    type="text/javascript"></script>
<script>
    function removeStudent(id) {
        Swal.fire({
            title: 'Confirm Deletion',
            text: `Candidate with ID ${id} will be deleted. Are you sure?`,
            type: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'Yes, delete it!'
        }).then((result) => {
            if (result.value) {
                $.ajax({
                    type: 'POST',
                    dataType: 'JSON',
                    url: '{% url "remove_student" %}',
                    data: {
                        'id': id,
                        csrfmiddlewaretoken: '{{ csrf_token }}'
                    },
                    success: function (data) {
                        Swal.fire("Deleted!", `Candidate with ID ${data} file has been deleted.`, "success")
                    }
                })
            }
        })
    }

    $(document).ready(function () {
        //$('#example').DataTable()

        const candidateRows = $('.candidate-row')

        $('#filter').on('input change', function (e) {
            const filterVal = e.target.value

            candidateRows.removeClass('hidden')

            if (filterVal === '') {
                return
            }

            const filtered = candidateRows.toArray().filter((row, index) => {
                return (
                    ($(row).find('td:nth(0)').html() != filterVal) &&
                    ($(row).find('td:nth(2)').html().indexOf(filterVal) === -1)
                    // ($(row).find('td:nth(3)').html() != filterVal) ||
                    // ($(row).find('td:nth(4)').html() != filterVal)
                )
            })

            filtered.forEach(function (row, index) {
                $(row).addClass('hidden')
            })
        })
    });
</script>
{% endblock %}

{% block body  %}
<link rel="stylesheet" href="
    https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.css" />
<link rel="stylesheet" href="https://cdn.datatables.net/1.10.20/css/dataTables.bootstrap4.min.css" />

<div class="kt-grid__item kt-grid__item--fluid kt-grid kt-grid--hor kt-wrapper" id="kt_wrapper">

    <!-- end:: Header -->
    <div class="kt-content  kt-grid__item kt-grid__item--fluid kt-grid kt-grid--hor" id="kt_content">

        <!-- begin:: Content -->
        <div class="kt-container  kt-container--fluid  kt-grid__item kt-grid__item--fluid">
            <div class="kt-portlet kt-portlet--mobile">
                <div class="kt-portlet__body kt-portlet__body--fit">

                    <div class="form-group">
                        <div class="input-icon">
                            <i class="fa fa-search font-green"></i>
                            <input type="text" class="form-control" placeholder="Filter by name, ID or contact number"
                                id="filter" />
                        </div>
                    </div>

                    <!--begin: Datatable -->
                    <table id="example" class="table table-striped table-bordered" style="width:100%">
                        <thead>
                            <tr>
                                <th>Candidate ID</th>
                                <th>Image</th>
                                <th>Full Name </th>
                                <th>CNIC</th>
                                <th>Contact</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for candidate in candidates %}
                            <tr class="candidate-row">
                                <td>{{ candidate.candidate_id }}</td>
                                <td>
                                    <img src="{{ candidate.image.url }}" width="100" height="100" class="thumbnail" />
                                </td>
                                <td>{{ candidate.firstname }} {{ candidate.lastname }}</td>
                                <td>{{ candidate.cnic }}</td>
                                <td>{{ candidate.phone }}</td>
                                <td>
                                    <button onclick="(function(e) {removeStudent({{ candidate.candidate_id }})})()"
                                        class="btn btn-danger">Delete</button>
                                </td>
                            </tr>

                            {% endfor %}

                        </tbody>

                    </table>

                    <!--end: Datatable -->
                </div>
            </div>
        </div>
        <!-- end:: Content -->
    </div>
</div>
</div>
</div>
{% endblock %}