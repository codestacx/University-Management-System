<!DOCTYPE html>
<html lang="en" >
<meta http-equiv="content-type" content="text/html;charset=UTF-8" />
<head>
        <meta charset="utf-8"/>

        <title>Login or Sign Up</title>

        {% load static %}
        <meta name="description" content="Login page example">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

        <!--begin::Fonts -->
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Poppins:300,400,500,600,700|Roboto:300,400,500,600,700">        <!--end::Fonts -->


                    <!--begin::Page Custom Styles(used by this page) -->
                             <link href="{% static '/themes/metronic/theme/default/demo1/dist/assets/css/pages/login/login-3.css' %}" rel="stylesheet" type="text/css" />
                        <!--end::Page Custom Styles -->

        <!--begin::Global Theme Styles(used by all pages) -->
                    <link href="{% static '/themes/metronic/theme/default/demo1/dist/assets/plugins/global/plugins.bundle.css' %}" rel="stylesheet" type="text/css" />
                    <link href="{% static '/themes/metronic/theme/default/demo1/dist/assets/css/style.bundle.css' %}" rel="stylesheet" type="text/css" />
                <!--end::Global Theme Styles -->

        <!--begin::Layout Skins(used by all pages) -->

<link href="{% static '/themes/metronic/theme/default/demo1/dist/assets/css/skins/header/base/light.css' %}" rel="stylesheet" type="text/css" />
<link href="{% static '/themes/metronic/theme/default/demo1/dist/assets/css/skins/header/menu/light.css' %}" rel="stylesheet" type="text/css" />
<link href="{% static '/themes/metronic/theme/default/demo1/dist/assets/css/skins/brand/dark.css' %}" rel="stylesheet" type="text/css" />
<link href="{% static '/themes/metronic/theme/default/demo1/dist/assets/css/skins/aside/dark.css' %}" rel="stylesheet" type="text/css" />        <!--end::Layout Skins -->

        <link rel="shortcut icon" href="/media/images/PUCIT-Logo.png"/>


<!-- Global site tag (gtag.js) - Google Analytics -->

    <style>
        .jumbotron.text-center {
    height: 17em;
}

input.form-control.col-md-6 {
    width: 50%;
    margin-right: 1em;
    display: inline;
}

div#notes {
    margin-top: 2%;
    width: 98%;
    margin-left: 1%;
}

@media (min-width: 991px) {
	.col-md-9.col-sm-12 {
    	margin-left: 12%;
	}
}
    </style>

<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-37564768-1');

</script>    </head>
    <!-- end::Head -->

    <!-- begin::Body -->
    <body
    class="kt-quick-panel--right kt-demo-panel--right kt-offcanvas-panel--right kt-header--fixed kt-header-mobile--fixed kt-subheader--enabled kt-subheader--fixed kt-subheader--solid kt-aside--enabled kt-aside--fixed kt-page--loading"  >

    	<!-- begin:: Page -->





	<div class="kt-grid kt-grid--ver kt-grid--root">
		<div class="kt-grid kt-grid--hor kt-grid--root  kt-login kt-login--v3 kt-login--signin" id="kt_login">
	<div class="kt-grid__item kt-grid__item--fluid kt-grid kt-grid--hor">
		<div class="kt-grid__item kt-grid__item--fluid kt-login__wrapper">
			<div class="kt-login__container">
				<div class="kt-login__logo">
					<a href="#">
						<img src="/media/images/PUCIT-Logo.png" width="80px" height="80px">
					</a>
				</div>
				<div class="kt-login__signin">
					<div class="kt-login__head">
						<h3 class="kt-login__title">Sign In</h3>

					</div>
					<form class="kt-form" method="post" action="{% url 'login' %}">
                        {% csrf_token %}
						<div class="input-group">
							<input class="form-control" type="text" placeholder="Email" name="email" required autocomplete="off">
						</div>
						<div class="input-group">
							<input class="form-control" type="password" placeholder="Password" required name="password">
						</div>
						<div class="row kt-login__extra">
							<div class="col">
								<label class="kt-checkbox">
									<input type="checkbox" name="remember"> Remember me
									<span></span>
								</label>
							</div>
							<div class="col kt-align-right">
								<a href="javascript:;" id="kt_login_forgot" class="kt-login__link">Forget Password ?</a>
							</div>
						</div>
						<div class="kt-login__actions">
                            <input type="submit"  class="btn btn-primary" value="Sign In"/>

                                 {% if messages %}
                                     <div class="alert alert-danger my-4">
                                    {%  for message in messages %}
                                        <ul>
                                        <li> {{ message }}</li>
                                        </ul>
                                        {% endfor %}
                                      </div>
                                    {% endif %}

{#							<input type="submit" id="kt_login_signin_submit" class="btn btn-brand btn-elevate kt-login__btn-primary" value="Sign In"/>#}
						</div>
					</form>
				</div>
				<div class="kt-login__signup">
					<div class="kt-login__head">
						<h3 class="kt-login__title">Sign Up</h3>
						<div class="kt-login__desc">Verify Your email address</div>
					</div>
					<form ... onkeydown="return event.key != 'Enter';" class="kt-form"action="{% url 'signup' %}" method="post">
                        {% csrf_token %}
						<div class="input-group">
							<input class="form-control" name="mail" id="email" required type="email" placeholder="Email"  style="display: inline;">

						</div>
                        <span id="message"></span>



						<div class="input-group">
							<input class="form-control" id="confirmationcode"  type="text" style="display: none" maxlength="6"
                                   placeholder="Confirmation Code" name="confirmationcode" autocomplete="off">
						</div>

                        <div id="pass" style="display: none">
                            <div  class="input-group">
							    <input id="password" class="form-control" type="password" placeholder="Password" name="password">
						    </div>
                        </div>

                        <div class="kt-login__actions">
                            <input type="button" id="sendCodeBtn" value="Next" class="btn btn-instagram" onclick="showConfirmationField()"/>
                        </div>



                             <div style="text-align: center" class="kt-login__actions">

                                 <button type="button" style="display: none;margin-left: auto;margin-right:auto;"  id="VerifyCodeBtn"
                                         class="btn btn-brand btn-elevate kt-login__btn-primary" onclick="VerifConfirmationField()">Confirm</button>
                                 <input type="submit" value="Sign Up" class="btn btn-instagram" name="submit"
                                        id="submit" style="display: none;margin-left: auto;margin-right: auto"/>

                            </div>

{#						<div class="kt-login__actions" style="display: none">#}
{#							<button id="kt_login_signup_submit" class="btn btn-brand btn-elevate kt-login__btn-primary">Verify</button>&nbsp;&nbsp;#}
{#							<button id="kt_login_signup_cancel" class="btn btn-light btn-elevate kt-login__btn-secondary">Cancel</button>#}
{#						</div>#}
					</form>
				</div>


				<div class="kt-login__forgot">
					<div class="kt-login__head">
						<h3 class="kt-login__title">Forgotten Password ?</h3>
						<div class="kt-login__desc">Enter your email to reset your password:</div>
					</div>
					<form class="kt-form" action="#" onsubmit="" method="post">
                        {% csrf_token %}
						<div class="input-group">
							<input class="form-control" type="text" placeholder="Email" name="reset_email" id="reset_email" >
						</div>
						<div class="kt-login__actions">
							 <button type="button"    id="ResetCodeBtn"
                                         class="btn btn-brand btn-elevate kt-login__btn-primary" onclick="resetpassword()">Request</button>&nbsp;
							<button id="kt_login_forgot_cancel" class="btn btn-light btn-elevate kt-login__btn-secondary">Cancel</button>
						</div>
					</form>

				</div>
				<div class="kt-login__account">
					<span class="kt-login__account-msg">
						Don't have an account yet ?
					</span>
					&nbsp;&nbsp;
					<a href="javascript:;" id="kt_login_signup" class="kt-login__account-link">Sign Up!</a>
				</div>
			</div>
		</div>
	</div>

        </div>

	</div>


<!-- end:: Page -->


        <!-- begin::Global Config(global config for global JS sciprts) -->
        <script>

            function resetpassword(){
                 var mail =document.getElementById('reset_email').value;
                 $.ajax({
                    type:'POST',
                    dataType:'json',
                    url:'{% url 'resetpasswords' %}',
                     data:{
                        'email':mail,
                         csrfmiddlewaretoken:'{{ csrf_token }}'
                     },
                     beforeSend:function(){
                           let timerInterval
                                Swal.fire({
                                  title: 'Email!',
                                  html: 'Verifying email please wait ... <b></b> milliseconds.',
                                  timer: 2000,
                                  timerProgressBar: true,
                                  onBeforeOpen: () => {
                                    Swal.showLoading()
                                    timerInterval = setInterval(() => {
                                      const content = Swal.getContent()
                                      if (content) {
                                        const b = content.querySelector('b')
                                        if (b) {
                                          b.textContent = Swal.getTimerLeft()
                                        }
                                      }
                                    }, 100)
                                  },
                                  onClose: () => {
                                    clearInterval(timerInterval)
                                  }
                                }).then((result) => {
                                  /* Read more about handling dismissals below */
                                  if (result.dismiss === Swal.DismissReason.timer) {
                                    console.log('I was closed by the timer')
                                  }
                                })
                        },
                     success:function (response) {
                         if(response.status==1){
                             swal.fire(response.msg)
                         }
                         else{
                             Swal.fire(
                              'Verification aborted!',
                              'No such email found!',
                              'error'
                            )
                         }
                     }
                 });
            }

            //function that verifies email code
            function VerifConfirmationField(){
                var mail =document.getElementById('email').value;
                var code =document.getElementById('confirmationcode').value;
                if(code==='' || code.length<6){
                    Swal.fire(
                              'Verification aborted!',
                              'Please enter 6 digit valid code!',
                              'error'
                    )
                    return;
                }
                $.ajax({
                   type:'POST',
                    dataType:'json',
                    url:'{% url 'verifymail' %}',
                    data:{
                        'email':mail,
                        'code':code,
                         csrfmiddlewaretoken: '{{ csrf_token }}',
                    },
                    success:function (data) {
                        if(data.status===true){
                            Swal.fire(
                                'Verification Done!',
                                'Your email has been verified!',
                                'success'
                            )
                            document.getElementById('email').readOnly=true
                            document.getElementById('confirmationcode').disabled=true
                            document.getElementById('VerifyCodeBtn').style.display='none'
                            document.getElementById('pass').style.display='block'
                            document.getElementById('submit').style.display='block'
                        }
                        else{
                            Swal.fire(
                              'Verification aborted!',
                              'Invalid code Please Try agian!',
                              'error'
                            )
                        }

                    }

                });
            }

            // function that verify email format
            function ValidateEmail(mail){
                 if (/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.test(mail))
                    {
                    return (true)
                  }

                    return (false)
            }

            // function that display confirmation text field
            function showConfirmationField() {
                var mail =document.getElementById('email').value;

                if(mail.length==0){
                     document.getElementById('message').innerHTML='<br><center><code>Please enter email </code></center>';
                }
                else if(!ValidateEmail(mail)){
                     document.getElementById('message').innerHTML='<br><center><code>Please enter valid email </code></center>';
                }
                else{

                    //ajax call for send email

                    $.ajax({
                        type:'POST',
                        url:'{% url 'sendmail' %}',
                        data:{
                            email:mail,
                            csrfmiddlewaretoken: '{{ csrf_token }}'
                        },
                        dataType:'json',
                        beforeSend:function(){
                           let timerInterval
                                Swal.fire({
                                  title: 'Email!',
                                  html: 'Verifying email please wait ... <b></b> milliseconds.',
                                  timer: 2000,
                                  timerProgressBar: true,
                                  onBeforeOpen: () => {
                                    Swal.showLoading()
                                    timerInterval = setInterval(() => {
                                      const content = Swal.getContent()
                                      if (content) {
                                        const b = content.querySelector('b')
                                        if (b) {
                                          b.textContent = Swal.getTimerLeft()
                                        }
                                      }
                                    }, 100)
                                  },
                                  onClose: () => {
                                    clearInterval(timerInterval)
                                  }
                                }).then((result) => {
                                  /* Read more about handling dismissals below */
                                  if (result.dismiss === Swal.DismissReason.timer) {
                                    console.log('I was closed by the timer')
                                  }
                                })
                        },
                        success:function (data) {


                            if(data.count>0){
                                Swal.fire(data.msg)
                                document.getElementById('confirmationcode').style.display='block'
                                document.getElementById('sendCodeBtn').style.display='none'
                                document.getElementById('VerifyCodeBtn').style.display='block';
                            }
                            else if(data.count==-2){
                                Swal.fire(data.msg)
                                document.getElementById('sendCodeBtn').style.display='none'
                                document.getElementById('pass').style.display='block'
                                document.getElementById('submit').style.display='block'
                            }
                            else{
                                 Swal.fire(data.msg)
                            }

                        }
                    });


                }


            }

            var KTAppOptions = {
    "colors": {
        "state": {
            "brand": "#5d78ff",
            "dark": "#282a3c",
            "light": "#ffffff",
            "primary": "#5867dd",
            "success": "#34bfa3",
            "info": "#36a3f7",
            "warning": "#ffb822",
            "danger": "#fd3995"
        },
        "base": {
            "label": [
                "#c5cbe3",
                "#a1a8c3",
                "#3d4465",
                "#3e4466"
            ],
            "shape": [
                "#f0f3ff",
                "#d9dffa",
                "#afb4d4",
                "#646c9a"
            ]
        }
    }
};
        </script>

        <!-- end::Global Config -->

    	<!--begin::Global Theme Bundle(used by all pages) -->
    	    	   <script src="{% static '/themes/metronic/theme/default/demo1/dist/assets/plugins/global/plugins.bundle.js' %}" type="text/javascript"></script>
		    	   <script src="{% static '/themes/metronic/theme/default/demo1/dist/assets/js/scripts.bundle.js' %}" type="text/javascript"></script>
				<!--end::Global Theme Bundle -->
                    <!--begin::Page Scripts(used by this page) -->
                            <script src="{% static '/themes/metronic/theme/default/demo1/dist/assets/js/pages/custom/login/login-general.js' %}" type="text/javascript"></script>
                        <!--end::Page Scripts -->
            </body>

</html>
